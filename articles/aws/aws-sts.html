<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="https://www.archerimagine.com/theme/css/elegant.prod.9e9d5ce754.css" media="screen">
        <link rel="stylesheet" type="text/css" href="https://www.archerimagine.com/theme/css/custom.css" media="screen">

        <link rel="dns-prefetch" href="//fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
        <link rel="alternate" type="application/rss+xml" title="Archer Imagine" href="https://www.archerimagine.com/feeds/all.atom.xml" />

        <meta name="google-site-verification" content="6B1Foj8HxdrASteMuBQX7Hyu6PCLUQCX_u4USDQ9xi8" />        <meta name="msvalidate.01" content="7186CB4D245BAA0092329C7B5FD2C5CD" />        <meta name="author" content="Animesh Bhadra" />

        <meta name="twitter:creator" content="@animeshkbhadra">
        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary_large_image">

<meta name="keywords" content="aws, cloud, aws, AWS STS, Security Token Service, IAM Roles, SAML 2.0, AssumeRole, AssumeRoleWithSAML, AssumeRoleWithWebIdentity, GetFederationToken, GetSessionToken, AccessKeyId, SecretAccessKey, SessionToken" />

<meta name="description" content="AWS STS or Security Token Service, provides temporary access credentials to access any AWS resource. This temporary access can be requested by other AWS account, or a federated user in case of hybrid cloud environment who can be authenticated using SAML 2.0, Web identity provider. AWS STS works very closely with IAM Roles." />
<meta property="og:title" content="Doing AWS STS the right way.  - Short Term Security "/>
<meta property="og:url" content="https://www.archerimagine.com/articles/aws/aws-sts.html" />
<meta property="og:description" content="AWS STS or Security Token Service, provides temporary access credentials to access any AWS resource. This temporary access can be requested by other AWS account, or a federated user in case of hybrid cloud environment who can be authenticated using SAML 2.0, Web identity provider. AWS STS works very closely with IAM Roles." />
<meta property="og:site_name" content="Archer Imagine" />
<meta property="og:article:author" content="Animesh Bhadra" />
<meta property="og:article:published_time" content="2021-03-20T16:20:58+05:30" />
<meta property="og:article:modified_time" content="2021-03-27T10:12:42+05:30" />
<meta name="twitter:title" content="Doing AWS STS the right way.  - Short Term Security ">
<meta name="twitter:description" content="AWS STS or Security Token Service, provides temporary access credentials to access any AWS resource. This temporary access can be requested by other AWS account, or a federated user in case of hybrid cloud environment who can be authenticated using SAML 2.0, Web identity provider. AWS STS works very closely with IAM Roles.">
<meta property="og:image" content="https://www.archerimagine.com/images/aws/IAM/05-AWS-STS.png" />
<meta name="twitter:image" content="https://www.archerimagine.com/images/aws/IAM/05-AWS-STS.png" >

        <title>Doing AWS STS the right way.  - Short Term Security  · Archer Imagine
</title>
        <link rel="shortcut icon" href="https://www.archerimagine.com/theme/images/favicon.ico" type="image/x-icon" />
        <link rel="icon" href="https://www.archerimagine.com/theme/images/apple-touch-icon-152x152.png" type="image/png" />
        <link rel="apple-touch-icon" href="https://www.archerimagine.com/theme/images/apple-touch-icon.png"  type="image/png" />
        <link rel="apple-touch-icon" sizes="57x57" href="https://www.archerimagine.com/theme/images/apple-touch-icon-57x57.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="72x72" href="https://www.archerimagine.com/theme/images/apple-touch-icon-72x72.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="76x76" href="https://www.archerimagine.com/theme/images/apple-touch-icon-76x76.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="114x114" href="https://www.archerimagine.com/theme/images/apple-touch-icon-114x114.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="120x120" href="https://www.archerimagine.com/theme/images/apple-touch-icon-120x120.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="144x144" href="https://www.archerimagine.com/theme/images/apple-touch-icon-144x144.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="152x152" href="https://www.archerimagine.com/theme/images/apple-touch-icon-152x152.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="152x152" href="https://www.archerimagine.com/theme/images/apple-touch-icon-180x180.png" type="image/png" />
        <link href="https://www.archerimagine.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Archer Imagine - Full Atom Feed" />
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-97386090-1', 'auto');
    ga('send', 'pageview');
</script>


    </head>
    <body>
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="https://www.archerimagine.com/"><span class=site-name>Archer Imagine</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                    <a href=
                                       https://www.archerimagine.com
                                    >Home</a>
                                </li>
                                <li ><a href="https://www.archerimagine.com/pages/aws-certification.html">Tutorials</a></li>
                                <li ><a href="https://www.archerimagine.com/categories">Categories</a></li>
                                <li ><a href="https://www.archerimagine.com/tags">Tags</a></li>
                                <li ><a href="https://www.archerimagine.com/archives">Archives</a></li>
                                <li><form class="navbar-search" action="https://www.archerimagine.com/search" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article itemscope>
<div class="row-fluid">
    <header class="page-header span10 offset2">
        <h1>
            <a href="https://www.archerimagine.com/articles/aws/aws-sts.html">
                Doing AWS STS the right way.
                <small class="subtitle">
                    Short Term Security
                </small>
            </a>
        </h1>
    </header>
</div>

<div class="row-fluid">
    <div class="span2 table-of-content">
        <nav>
        <h4>Contents</h4>
        <div class="toc">
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#aws-sts">AWS STS</a><ul>
<li><a href="#benefits-of-aws-sts">Benefits of AWS STS</a></li>
<li><a href="#when-to-use-aws-sts">When to use AWS STS</a></li>
<li><a href="#aws-sts-actions">AWS STS Actions</a></li>
</ul>
</li>
<li><a href="#aws-sts-assumerole-action">AWS STS | AssumeRole Action</a><ul>
<li><a href="#aws-sts-create-role">AWS STS | Create Role</a></li>
<li><a href="#aws-sts-change-the-trust-relationship">AWS STS | Change the trust relationship</a></li>
<li><a href="#aws-sts-boto3-code-to-assumerole">AWS STS | BOTO3 code to  AssumeRole</a></li>
<li><a href="#aws-sts-assumerole-return-parameters">AWS STS | AssumeRole | Return Parameters</a></li>
</ul>
</li>
<li><a href="#conclusion">Conclusion</a></li>
<li><a href="#reference">Reference</a></li>
</ul>
</div>
        </nav>
    </div>
    <div class="span8 article-content">
            
            
<p><img alt="AWS Made Easy | AWS STS, Security Token Service " src="https://www.archerimagine.com/images/aws/IAM/05-AWS-STS.png" title="AWS Made Easy | AWS STS, Security Token Service"/></p>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">¶</a></h2>
<p>You have seen in the previous topic on <a href="https://www.archerimagine.com/articles/aws/aws-iam-roles.html">IAM Roles</a>, some users and resource can assume a role, moreover an IAM Roles are like a hat which anyone can wear and gets its power. One important part of this should bother you, how does AWS authenticate such users, if the user is a genuine or not.</p>
<p>AWS STS of Security token service plays an important part in enabling <a href="https://www.archerimagine.com/articles/aws/aws-iam-roles.html">IAM Roles</a>. When you are using a cross account resource or any federated users, you can also use AWS STS to provide temporary user credentials.</p>
<p>AWS STS though can be used to support mobile application using AWS resources, but it is advised to use AWS cognitio, which will be discussed in the future.</p>
<p>You will learn what is AWS STS, what are its benefits, when to use it. You will also learn to use a specific Action/API called <code>assumerole</code> to get access to an AWS resource for an AWS cross account.</p>
<h2 id="aws-sts">AWS STS<a class="headerlink" href="#aws-sts" title="Permanent link">¶</a></h2>
<p>AWS STS (Security token service) as the name suggest, provides a security token for accessing a AWS resources. You may think AWS STS as the provider of temporary access. </p>
<p>AWS STS has these specific properties when assigning temporary access</p>
<ul>
<li>It can range from few minutes to a few hours.</li>
<li>Once the AWS STS provided temporary token expires, it cannot be reused at any point.</li>
<li>You can invoke AWS STS only through AWS SDKs or AWS CLIs.</li>
</ul>
<p><img alt="AWS Made Easy | AWS STS, Properties " src="https://www.archerimagine.com/images/aws/IAM/AWS-STS-properties.png" title="AWS Made Easy | AWS STS, Properties"/></p>
<h3 id="benefits-of-aws-sts">Benefits of AWS STS<a class="headerlink" href="#benefits-of-aws-sts" title="Permanent link">¶</a></h3>
<p>AWS STS solves a very specific problem for you, when you want someone to temporarily access your AWS resource without having concerns of revoking the permission.</p>
<p>AWS STS provides a way to</p>
<ul>
<li>You should not embedded long term AWS security credentials into an application.</li>
<li>You should not create extra IAM identities, using IAM roles with AWS STS is enough to satisfy the temporary access requirement.</li>
<li>You do not have to worry about deactivating the AWS STS credentials, 36 hours is the maximum you can set the AWS STS expiry time depending on the API invoked.</li>
</ul>
<p><img alt="AWS Made Easy | AWS STS, Benefits " src="https://www.archerimagine.com/images/aws/IAM/AWS-STS-Benefits.png" title="AWS Made Easy | AWS STS, Benefits"/></p>
<h3 id="when-to-use-aws-sts">When to use AWS STS<a class="headerlink" href="#when-to-use-aws-sts" title="Permanent link">¶</a></h3>
<p>You have now understood what is AWS STS, also what are the benefits of AWS STS. You might also have guessed the use cases for using AWS STS. Here if a breakdown for this.</p>
<ul>
<li>In Hybrid Cloud setup, where you have to give access to the non AWS account holder. These methods are generally used for giving access to 3rd party<ul>
<li>SAML 2.0 Identity federation.</li>
<li>Web Identity Federation. (Facebook, Github, etc.)</li>
</ul>
</li>
<li>Cross Account roles, when you have to give your developer account a temporary access to your production account.</li>
<li>IAM roles for AWS services.</li>
</ul>
<p><img alt="AWS Made Easy | AWS STS, UseCase " src="https://www.archerimagine.com/images/aws/IAM/AWS-STS-UseCase.png" title="AWS Made Easy | AWS STS, UseCase"/></p>
<h3 id="aws-sts-actions">AWS STS Actions<a class="headerlink" href="#aws-sts-actions" title="Permanent link">¶</a></h3>
<p>You should learn about these five common AWS STS Actions.</p>
<ul>
<li><code>AssumeRole</code> : This is used for getting cross account access.</li>
<li><code>AssumeRoleWithWebIdentity</code> : This is using any 3rd party web IDP like Google or Facebook.</li>
<li><code>AssumeRoleWithSAML</code> : This is for hybrid cloud, where you have an entity with SAML 2.0</li>
<li><code>GetFederationToken</code> : This is used by the AWS root account or any IAM user.</li>
<li><code>GetSessionToken</code> : This is used by the AWS root account or any IAM user.</li>
</ul>
<p>Here is a comparison for you on the above APIs.</p>
<p><img alt="AWS Made Easy | AWS STS, API Comparison " src="https://www.archerimagine.com/images/aws/IAM/AWS-STS-API-Comparision.png" title="AWS Made Easy | AWS STS, API Comparison."/></p>
<h2 id="aws-sts-assumerole-action">AWS STS | AssumeRole Action<a class="headerlink" href="#aws-sts-assumerole-action" title="Permanent link">¶</a></h2>
<p>You have the basic understanding of the different Action provided by AWS STS. Let's now try to use <code>AssumeRole</code> API to understand how this works.</p>
<p>Here is what you are going to try, or what we call a problem definition.</p>
<blockquote>
<p>You will have a user with no permission on the AWS Account. Now create an IAM Role, with AmazonS3FullAccess permission. Once you have the Role, edit the trust relationship to give ARN of the user which does not have any permission. Now using AWS Boto3 SDK you will make the user connect to AWS.</p>
</blockquote>
<p>A pictorial representation of the step to help you understand.</p>
<p><img alt="AWS Made Easy | AWS STS, Cross Account AssumeRole" src="https://www.archerimagine.com/images/aws/IAM/Cross-Account-Role.png" title="AWS Made Easy | AWS STS, Cross Account AssumeRole"/></p>
<h3 id="aws-sts-create-role">AWS STS | Create Role<a class="headerlink" href="#aws-sts-create-role" title="Permanent link">¶</a></h3>
<p>You have to follow all the steps mentioned in the article, <a href="https://www.archerimagine.com/articles/aws/aws-iam-roles.html#how-to-create-an-aws-iam-role">IAM Roles</a>. Once change would be this time we should select the <strong>Another AWS account</strong> option. You may need to give the 12 digit account number.</p>
<p>The above steps are the same we will use for cross account access. The steps will not change.</p>
<h3 id="aws-sts-change-the-trust-relationship">AWS STS | Change the trust relationship<a class="headerlink" href="#aws-sts-change-the-trust-relationship" title="Permanent link">¶</a></h3>
<p>When you create the role like it is mentioned in the previous step, by default it will always point to the account root user, you have to change it to the ARN of the user you want to do a <code>AssumeRole</code>. Here is how you can do it.</p>
<ul>
<li>Select the role.</li>
<li>Click on <strong>Trust Relationship</strong> options, and select the <em>Edit trust relationship</em> button.<ul>
<li><img alt="AWS Made Easy | AWS STS, STS | Edit Trust Relationship " src="https://www.archerimagine.com/images/aws/IAM/edit-trust-relationship.png" title="AWS Made Easy | AWS STS, Edit Trust Relationship"/></li>
</ul>
</li>
<li>This will open a JSON Editor and edit the JSON for this particular user shown below, esp. the Principal, AWS option.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
  <span class="nt">"Version"</span><span class="p">:</span> <span class="s2">"2012-10-17"</span><span class="p">,</span>
  <span class="nt">"Statement"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">"Effect"</span><span class="p">:</span> <span class="s2">"Allow"</span><span class="p">,</span>
      <span class="nt">"Principal"</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">"AWS"</span><span class="p">:</span> <span class="s2">"arn:aws:iam::123456789012:user/Test"</span>
      <span class="p">},</span>
      <span class="nt">"Action"</span><span class="p">:</span> <span class="s2">"sts:AssumeRole"</span><span class="p">,</span>
      <span class="nt">"Condition"</span><span class="p">:</span> <span class="p">{}</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<p>You might be thinking, if we have to edit this option every time we have to assign to a new user, then how is this scalable? </p>
<p>The answer is, most of the time we will add a particular group with the IAM role attached and the required user is added or removed from the group to control the access.</p>
<h3 id="aws-sts-boto3-code-to-assumerole">AWS STS | BOTO3 code to  AssumeRole<a class="headerlink" href="#aws-sts-boto3-code-to-assumerole" title="Permanent link">¶</a></h3>
<p>Now you have to write using the BOTO3 SDK provide for Python, the sample code to <code>AssumeRole</code>. Here is the sample code.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">boto3</span>
<span class="kn">import</span> <span class="nn">pprint</span>
<span class="kn">from</span> <span class="nn">boto3.session</span> <span class="kn">import</span> <span class="n">Session</span>

<span class="c1"># Below is the ARN of the role.</span>
<span class="n">arn</span> <span class="o">=</span> <span class="s2">"arn:aws:iam::123456789012:role/account-s3-full-access"</span>
<span class="n">session_name</span> <span class="o">=</span> <span class="s2">"example-role"</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s2">"sts"</span><span class="p">)</span>
<span class="n">account_id</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_caller_identity</span><span class="p">()[</span><span class="s2">"Account"</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">account_id</span><span class="p">)</span>

<span class="c1"># Assume role takes the roles ARN and a sample session name</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">assume_role</span><span class="p">(</span><span class="n">RoleArn</span><span class="o">=</span><span class="n">arn</span><span class="p">,</span> <span class="n">RoleSessionName</span><span class="o">=</span><span class="n">session_name</span><span class="p">)</span>

<span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

<span class="c1"># Create an S3 resource that can access the account with the temporary credentials.</span>
<span class="n">temp_credentials</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">"Credentials"</span><span class="p">]</span>

<span class="c1"># Access the S3 as a resource passing the temporary credentials received from STS.</span>
<span class="n">s3_resource</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span>
    <span class="s2">"s3"</span><span class="p">,</span>
    <span class="n">aws_access_key_id</span><span class="o">=</span><span class="n">temp_credentials</span><span class="p">[</span><span class="s2">"AccessKeyId"</span><span class="p">],</span>
    <span class="n">aws_secret_access_key</span><span class="o">=</span><span class="n">temp_credentials</span><span class="p">[</span><span class="s2">"SecretAccessKey"</span><span class="p">],</span>
    <span class="n">aws_session_token</span><span class="o">=</span><span class="n">temp_credentials</span><span class="p">[</span><span class="s2">"SessionToken"</span><span class="p">],</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Listing buckets for the assumed role's account:"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">bucket</span> <span class="ow">in</span> <span class="n">s3_resource</span><span class="o">.</span><span class="n">buckets</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">bucket</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</code></pre></div>
<p>Once you run the above code, you should be getting the list of S3 buckets in your account. Though the user did not have access initially.</p>
<h3 id="aws-sts-assumerole-return-parameters">AWS STS | AssumeRole | Return Parameters<a class="headerlink" href="#aws-sts-assumerole-return-parameters" title="Permanent link">¶</a></h3>
<p>You should be thinking what is returned by STS, here is the JSON response returned by calling <code>assume_role</code> BOTO3 API.</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
   <span class="nt">"AssumedRoleUser"</span><span class="p">:{</span>
      <span class="nt">"Arn"</span><span class="p">:</span><span class="s2">"arn:aws:sts::123456789012:assumed-role/acc-s3-full-access/example-role"</span><span class="p">,</span>
      <span class="nt">"AssumedRoleId"</span><span class="p">:</span><span class="s2">"AROAUXRIFYXT7BG3ENQGE:example-role"</span>
   <span class="p">},</span>
   <span class="nt">"Credentials"</span><span class="p">:{</span>
      <span class="nt">"AccessKeyId"</span><span class="p">:</span><span class="s2">"ASIAUXRIFYXTUVPIQWFL"</span><span class="p">,</span>
      <span class="nt">"Expiration"</span><span class="p">:</span><span class="err">datetime.datetime(</span><span class="mi">2021</span><span class="p">,</span><span class="err">3,20,9,24,27,</span><span class="nt">"tzinfo=tzutc())"</span><span class="p">,</span>
      <span class="nt">"SecretAccessKey"</span><span class="p">:</span><span class="s2">"BsXYZCGNuemA8wevm6CnYVfZtNgdGaoOCJ4VwXnf"</span><span class="p">,</span>
      <span class="nt">"SessionToken"</span><span class="p">:</span><span class="s2">"FwoGZXIvYXdzEEoaDFAVerghnmasN971Z76yKwAfJgq3tccU72Gj6Xl28zJwJIUS/UEEMtwYmxUDsplTKg0if/keQ9z1BdoPFdLsmDtUiWDnfvIkICUbCeVk+DKI4c9LtdIAXmhpssg4IAMncYFsmh+ylOdbbcud134TOkDkCtuZMkfKuUbIMG3lTq10k93DsiUFAoH5pqyLAa9IyqHUbKUxwwde0UAcUU1lNFMO/sTZI8kAIQNM4cpGMxdyPsYZaX5M1IGWqr2gPNLqLtKLvi1oIGMi33r+lP9GWX5W+Ich1MHUAfUfhgqIjXHjpmDQY5S0e/WOTBwrPLoorgXQlHMak="</span>
   <span class="p">},</span>
   <span class="nt">"ResponseMetadata"</span><span class="p">:{</span>
      <span class="nt">"HTTPHeaders"</span><span class="p">:{</span>
         <span class="nt">"content-length"</span><span class="p">:</span><span class="s2">"1057"</span><span class="p">,</span>
         <span class="nt">"content-type"</span><span class="p">:</span><span class="s2">"text/xml"</span><span class="p">,</span>
         <span class="nt">"date"</span><span class="p">:</span><span class="s2">"Sat, 20 Mar 2021 08:24:27 GMT"</span><span class="p">,</span>
         <span class="nt">"x-amzn-requestid"</span><span class="p">:</span><span class="s2">"72f38158-1d90-4619-a431-5a2fcf460a31"</span>
      <span class="p">},</span>
      <span class="nt">"HTTPStatusCode"</span><span class="p">:</span><span class="mi">200</span><span class="p">,</span>
      <span class="nt">"RequestId"</span><span class="p">:</span><span class="s2">"72f38158-1d90-4619-a431-5a2fcf460a31"</span><span class="p">,</span>
      <span class="nt">"RetryAttempts"</span><span class="p">:</span><span class="mi">0</span>
   <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>You should really be concerned about the <code>Credentials</code> parameters which is returned. It basically provides 4 information.</p>
<ul>
<li>AccessKeyId : The access key id, which is always required for programmatic access.</li>
<li>Expiration : Generally it is 15 min, but can vary depending on the type of API being called.</li>
<li>SecretAccessKey : The secret access key, which is also generated only once.</li>
<li>SessionToken : As the name suggests, a unique way of identifying the session.</li>
</ul>
<h2 id="conclusion">Conclusion<a class="headerlink" href="#conclusion" title="Permanent link">¶</a></h2>
<p>You might have now understood that <a href="https://www.archerimagine.com/articles/aws/aws-iam-roles.html">IAM Roles</a> and AWS STS have a symbiotic relationship. AWS STS is required when you need to provide these range of access.</p>
<ul>
<li>The cross account use case, ex. the developer account my need a temporary access to the production system.</li>
<li>The Hybrid cloud use case, ex. On premise user, authenticated using SAML may need access to AWS resources.</li>
<li>In Hybrid cloud use case and cross account use case, ex. Authenticating the user using the web identity providers.</li>
<li>Sometimes IAM Services may need permission to another service, ex EC2 wants to write to a S3 bucket.</li>
</ul>
<p>The above access is provided to you using the AWS STS because.</p>
<ul>
<li>AWS STS provides short term credentials, which lives from a few minutes to some hours.</li>
<li>We should not be bothered to revoke the access as you cannot reuse the expired access.</li>
<li>AWS STS can be provided using the AWS SDKs or CLIs.</li>
</ul>
<p>The real benefits of AWS STS are,</p>
<ul>
<li>No need to embed long term credentials to the application.</li>
<li>No need to create multiple identities for each access request.</li>
<li>No need to revoke the access, as it expires automatically.</li>
</ul>
<p>The various actions provided by AWS STS are</p>
<ul>
<li><code>AssumeRole</code></li>
<li><code>AssumeRoleWithWebIdentity</code> </li>
<li><code>AssumeRoleWithSAML</code> </li>
<li><code>GetFederationToken</code> </li>
<li><code>GetSessionToken</code> </li>
</ul>
<p>and we discussed <code>AssumeRole</code> Action uses the cross account example, where you created an IAM role, edited the trust relationship and then the user assuming the role, by using the Boto3 SDKs. By doing this the IAM user from another account could access AWS resources for a short period of time.</p>
<p>The <code>AssumeRole</code> returns these parameters when a call is made it </p>
<ul>
<li>AccessKeyId </li>
<li>Expiration </li>
<li>SecretAccessKey </li>
<li>SessionToken </li>
</ul>
<p>You might recognize it returns all the parameters created for IAM user having programmatic access, i.e. AccessKeyId and SecretAccessKey. In addition, we get the SessionToken and an expiration time.</p>
<p>Please provide you feedback if you have any other use case for AWS STS.</p>
<h2 id="reference">Reference<a class="headerlink" href="#reference" title="Permanent link">¶</a></h2>
<ul>
<li>Photo by <a href="https://unsplash.com/@alesnesetril">Ales Nesetril </a> on <a href="https://unsplash.com/s/photos/technology">Unsplash</a></li>
<li><a href="https://aws.amazon.com/blogs/security/how-to-use-a-single-iam-user-to-easily-access-all-your-accounts-by-using-the-aws-cli/">How to Use a Single IAM User to Easily Access All Your Accounts by Using the AWS CLI</a></li>
<li><a href="https://devopslearning.medium.com/introduction-to-aws-security-token-service-sts-b3049aade3c1">Introduction to AWS Security Token Service(STS)</a></li>
<li><a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_switch-role-api.html">Switching to an IAM role (AWS API)</a></li>
<li><a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_common-scenarios_aws-accounts.html">Providing access to an IAM user in another AWS account that you own </a></li>
<li><a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_temp_request.html">Requesting temporary security credentials</a></li>
<li><a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_switch-role-console.html">Switching to a role (console)</a></li>
<li><a href="https://gist.github.com/DaisukeMiyamoto/2d9ed49dc7625adc41835beab7aad58e">Boto3 Python Gist </a></li>
</ul>


             


<div class="applause_button">
    <applause-button url=https://www.archerimagine.com/articles/aws/aws-sts.html> </applause-button>
</div>

 
                <p id="post-share-links">
    Spread the word....
      <a href="https://twitter.com/intent/tweet?text=Doing%20AWS%20STS%20the%20right%20way.%20Short%20Term%20Security&url=https%3A//www.archerimagine.com/articles/aws/aws-sts.html&via=animeshkbhadra&hashtags=aws,cloud" target="_blank" rel="nofollow noopener noreferrer" title="Share on Twitter">Twitter</a>
 ❄       <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A//www.archerimagine.com/articles/aws/aws-sts.html" target="_blank" rel="nofollow noopener noreferrer" title="Share on Facebook">Facebook</a>
 ❄       <a href="mailto:?subject=Doing%20AWS%20STS%20the%20right%20way.%20Short%20Term%20Security&amp;body=https%3A//www.archerimagine.com/articles/aws/aws-sts.html" target="_blank" rel="nofollow noopener noreferrer" title="Share via Email">Email</a>

            
            







            <hr/>
<section>
    <h2>Related Posts</h2>
<ul class="related-posts-list">
<li><a href="https://www.archerimagine.com/articles/aws/aws-iam-api-keys.html" title="Who really uses AWS IAM API keys? - Developers Delight">Who really uses AWS IAM API keys? <small>Developers Delight</small></a></li>
<li><a href="https://www.archerimagine.com/articles/aws/aws-kms.html" title="The Dummies Guide to AWS KMS. - AWS KMS is sexy.">The Dummies Guide to AWS KMS. <small>AWS KMS is sexy.</small></a></li>
<li><a href="https://www.archerimagine.com/articles/aws/aws-inspector-tutorials.html" title="The AWS Inspector Blog of your dreams - The secret agent in cloud [2021].">The AWS Inspector Blog of your dreams <small>The secret agent in cloud [2021].</small></a></li>
<li><a href="https://www.archerimagine.com/articles/aws/aws-cognito-tutorials.html" title="How to start using AWS Cognito - Authorize, Authenticate and Federate user in [2021]">How to start using AWS Cognito <small>Authorize, Authenticate and Federate user in [2021]</small></a></li>
<li><a href="https://www.archerimagine.com/articles/aws/aws-ec2-tutorial.html" title="The Insider&#39;s Guide to AWS EC2 - Create first EC2 Instance in [2021]">The Insider's Guide to AWS EC2 <small>Create first EC2 Instance in [2021]</small></a></li>
</ul>
<hr />
</section>
            <aside>
            <nav>
            <ul class="articles-timeline">
                <li class="previous-article">« <a href="https://www.archerimagine.com/articles/aws/aws-iam-roles.html" title="Previous: A foolproof guide to AWS IAM Roles - A Hat to wear!!">A foolproof guide to AWS IAM Roles <small class="subtitle">A Hat to wear!!</small></a></li>
                <li class="next-article"><a href="https://www.archerimagine.com/articles/aws/aws-iam-api-keys.html" title="Next: Who really uses AWS IAM API keys? - Developers Delight">Who really uses AWS IAM API keys? <small class="subtitle">Developers Delight</small></a> »</li>
            </ul>
            </nav>
            </aside>
        </div>
        <section id="article-sidebar" class="span2">
            <h4>Published</h4>
            <time itemprop="dateCreated" datetime="2021-03-20T16:20:58+05:30">Sat 20 March 2021</time>
<h4>Last Updated</h4>
<time datetime="2021-03-27T10:12:42+05:30">Mar 27, 2021</time>

            <h4>Category</h4>
            <a class="category-link" href="https://www.archerimagine.com/categories#aws-ref">aws</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="https://www.archerimagine.com/tags#aws-ref">aws
                    <span class="superscript">12</span>
</a></li>
                <li><a href="https://www.archerimagine.com/tags#cloud-ref">cloud
                    <span class="superscript">12</span>
</a></li>
            </ul>
<h4>Stay in Touch</h4>
<div id="sidebar-social-link">
    <a href="https://github.com/archeranimesh" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="GitHub" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1B1817"/><path fill="#fff" d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
    </a>
    <a href="https://www.facebook.com/animeshkbhadra" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="Facebook" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1877f2"/><path d="M355.6 330l11.4-74h-71v-48c0-20.2 9.9-40 41.7-40H370v-63s-29.3-5-57.3-5c-58.5 0-96.7 35.4-96.7 99.6V256h-65v74h65v182h80V330h59.6z" fill="#fff"/></svg>
    </a>
    <a href="https://www.reddit.com/user/archerimagine/" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="Reddit" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#f40"/><g fill="#fff"><ellipse cx="256" cy="307" rx="166" ry="117"/><circle cx="106" cy="256" r="42"/><circle cx="407" cy="256" r="42"/><circle cx="375" cy="114" r="32"/></g><g stroke-linecap="round" stroke-linejoin="round" fill="none"><path d="m256 196 23-101 73 15" stroke="#fff" stroke-width="16"/><path d="m191 359c33 25 97 26 130 0" stroke="#f40" stroke-width="13"/></g><g fill="#f40"><circle cx="191" cy="287" r="31"/><circle cx="321" cy="287" r="31"/></g></svg>
    </a>
    <a href="https://twitter.com/animeshkbhadra" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="Twitter" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1da1f3"/><path fill="#fff" d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></svg>
    </a>
</div>
            



<!-- Begin MailChimp Signup Form -->
<div id="mc-embed-signup">
<form action="//archerimagine.us15.list-manage.com/subscribe/post?u=e95cf93fc00f17a742b9480eb&amp;id=b690f10a78" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
<h4>Email Newsletter</h4>
<input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="Enter your email..." required>
<div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
</form>
</div>
<!--End mc_embed_signup-->




            





        </section>
</div>
</article>
<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe.
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides.
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo https://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>

    <div>
        <span class="site-name">Archer Imagine</span> - Anyone can do my job, but no one can be me. Harvey
    </div>



    <div id="fpowered">
        Powered by: <a href="http://getpelican.com/" title="Pelican Home Page" target="_blank" rel="nofollow noopener noreferrer">Pelican</a>
        Theme: <a href="https://elegant.oncrashreboot.com/" title="Theme Elegant Home Page" target="_blank" rel="nofollow noopener noreferrer">Elegant</a>
    </div>
</footer>            
        <script src="https://code.jquery.com/jquery.min.js"></script>
        
        <script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        
        <script src="https://www.archerimagine.com/theme/js/elegant.prod.9e9d5ce754.js"></script>
        
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    <!--
        <script defer src="https://my.hellobar.com/0b8d4f8c5d8236e3cfef139b484c76d42822714a.js" type="text/javascript" charset="utf-8" async="async"></script>
    -->
    <script async>(function(s,u,m,o,j,v){j=u.createElement(m);v=u.getElementsByTagName(m)[0];j.async=1;j.src=o;j.dataset.sumoSiteId='3bce642f377979511f2addc6af908c7b854c74137d5a52ca3f2b996bb51bfa0c';v.parentNode.insertBefore(j,v)})(window,document,'script','//load.sumo.com/');</script>
    
    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>